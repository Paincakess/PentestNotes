# Secuirty Mechanims Evasion while using NMAP
As a penetration tester we will eventually come across with systems and networks that are protected by Firewall, Intrusion Prevention System (IPS), Intrusion Detection System (IDS) and other security configurations, which can block the information we are trying gather or alert the network administrators about the suspicious activities. It is important to learn and avoid and evade those software and configurations.

# Evasion Techniques
## Using Decoy Addresses
> It is not an actual evasion technique, but sure helps in obscuring the source of scan.
- `nmap -D RND:10 <target>` (Generates a random number of decoys)
- `nmap -D decoy1, decoy2, decoy3 <target>` (Manually specify the IP addresses of the decoys)
## Using Proxies 
> By using proxies, the IP addresses of the proxies are recorded making it very difficult to trace the source of the scan
> We can also use [TOR](https://www.investopedia.com/terms/t/tor.asp) network or [Proxychains](https://medium.com/swlh/proxying-like-a-pro-cccdc177b081#:~:text=ProxyChains%20is%20a%20tool%20that%20forces%20any%20TCP%20connection%20made,program%20through%20a%20proxy%20server.).
- `nmap -sS --proxies socks4://115.29.161.103:1080, http://213.85.92.10:80`
## MAC Address Spoofing
> If the Target’s security mechanisms are configured to filter MAC addresses or has a rule to allow traffic from only certain MAC address, this technique will be very effective in those situations.
- `nmap --spoof-mac` 
- `nmap --spoof-mac 0` (Generates a random MAC address)
- `nmap --spoof-mac Dell/HP/Apple` (Specify MAC address from a Vendor)
## Ping Suppression
> The ICMP ping (echo request, echo reply) on firewall are often blocked in the Firewall by network administrators for keeping attackers from being able to find active hosts.
- `nmap -Pn <target>`
## Half Open Scan (ACK Scan)
> The firewall assumes that ACK packets is part of an established communication between server and client and let is pass.
- `nmap -sA <target>`
## Fragmentation
> In this technique, we break the IP header into many small pieces to evade the security mechanisms. The fragments are again reassembled at the target machine.
- `nmap -f --top-ports` 
- `nmap -ff --top-ports` (for more smaller fragments use the -ff switch).
## Scanning With Delay
> Most intrusion detection systems (IDS) only warn after a certain number of scans are performed. Snort, for example, only warns on scans when 15 or more ports are searched per second by default. If we can slow down the pace of our scan, it will be able to pass straight through the IDS without notifying the administrator.
- `nmap --scan_delay 5s <target>`
- `nmap -T0 <target>` (“-T” timing switch to slow down the scan)
- `nmap --ttl <value> <target>` ( Use “ttl” if you are in a slow network and you don't want your scan to be timed out early, it sets the IPv4 time-to-live field in sent packets to the given value (milliseconds))
## Changing Data Length
> Most firewalls and intrusion detection systems (IDS) contain signatures for nmap scans dependent on the length of the packet. The default data length of nmap's scanning packets is included in these signatures.
> These packets are often rather little (TCP scan is 40 bytes and an ICMP scan is just 28 bytes).
- `nmap -sS –data-length 120 <target>`
- **payloads larger than 1400 bytes are NOT allowed**.
## Transmission Unit 
> It is an expansion of the fragmentation options in nmap. A fragmentation option of –f is equivalent to requesting a —mtu of 8, while a fragmentation option of “–ff” is equivalent to specifying a “— mtu” of 16.
- `nmap -mtu 24 <target>`
- **Maximum Transmission Unit (mtu) must be a power of eight (8,16,24,32. . . )**
## Randomized Scan
> Before scanning, each group of up to 16384 hosts is shuffled which will not notify the firewall, this strategy paired with slow timing choices in nmap is very effective
- `nmap --randomize-hosts <target>`
## Using Combined Technique
> We can combine many of these approaches to ensure that your scans are not discovered. For example, you might delay the scan to T1, fragment the packets (-f), prolong the packet to 1200 bytes, and employ proxies.
- `nmap -sS -T1 -f --badsum --data-length 1200 --proxies sock4://176.57.216.214:80,http://213.85.92.10:80 <target>`
- **Scans like this are nearly undetectable, but also very slow**